# CSharp-Microservices
.NET / C# microservices labs: Clean Architecture, Postgres, gRPC Gateway, Kafka
# Microservices Labs - ITMO University

–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ C# –∏ .NET 8.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Backend**: C# (.NET 9), ASP.NET Core
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: Hexagonal Architecture, Microservices
- **–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è**: gRPC, HTTP REST, Kafka
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL, Npgsql
- **ORM & –ú–∏–≥—Ä–∞—Ü–∏–∏**: FluentMigrator
- **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: Docker, Docker Compose
- **Dependency Injection**: Microsoft.Extensions.DependencyInjection
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: Microsoft.Extensions.Configuration, Custom Configuration Providers
- **HTTP –∫–ª–∏–µ–Ω—Ç—ã**: Refit, HttpClientFactory
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: Swagger/OpenAPI
- **–ö–æ–Ω—Å–æ–ª—å**: Spectre.Console

## –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### Lab 1: Dependency Injection & Configuration
–û—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã —Å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –∏ —Å–∏—Å—Ç–µ–º–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ .NET.

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- Dependency Injection –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- Microsoft.Extensions.Configuration
- Options Pattern

### Lab 2: HTTP –∫–ª–∏–µ–Ω—Ç—ã –∏ Custom Configuration Provider
–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π.

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- HTTP –∫–ª–∏–µ–Ω—Ç —Å —Ä—É—á–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ —á–µ—Ä–µ–∑ Refit
- –ü–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- Custom ConfigurationProvider —Å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- –ö–æ–Ω—Å–æ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (Spectre.Console)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Refit –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã—Ö HTTP –∫–ª–∏–µ–Ω—Ç–æ–≤
- IHttpClientFactory
- Microsoft.Extensions.Configuration
- PeriodicTimer –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- Spectre.Console –¥–ª—è UI

### Lab 3: Product Service (Hexagonal Architecture + gRPC)
–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∑–∞–∫–∞–∑–æ–≤ —Å –≥–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- **–¢–æ–≤–∞—Ä—ã**: —Å–æ–∑–¥–∞–Ω–∏–µ, –ø–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- **–ó–∞–∫–∞–∑—ã**: –ø–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª (—Å–æ–∑–¥–∞–Ω–∏–µ ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ/–æ—Ç–º–µ–Ω–∞)
- **–ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤**: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, soft delete
- **–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤**: –∞—É–¥–∏—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω–æ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- Hexagonal Architecture (Ports & Adapters)
- gRPC Presentation Layer
- HTTP Gateway —Å REST API
- Repository Pattern
- SQL –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ FluentMigrator

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- gRPC —Å oneof –¥–ª—è –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞
- PostgreSQL + Npgsql (raw SQL)
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- Custom gRPC Interceptors
- Middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏

### Lab 4: Event-Driven Architecture —Å Kafka
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ —Å —Å–∏—Å—Ç–µ–º–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤ —á–µ—Ä–µ–∑ Kafka.

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- Producer –¥–ª—è —Ç–æ–ø–∏–∫–∞ `order_creation`
- Consumer –¥–ª—è —Ç–æ–ø–∏–∫–∞ `order_processing`
- –ë–∞—Ç—á–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–∞–∫–∞–∑–∞
- REST —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤

**Event Flow:**
```
–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ‚Üí Processing ‚Üí –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ ‚Üí 
–£–ø–∞–∫–æ–≤–∫–∞ ‚Üí –î–æ—Å—Ç–∞–≤–∫–∞ ‚Üí –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ/–û—Ç–º–µ–Ω–∞
```

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Apache Kafka
- Protobuf –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- Background Services
- Kafka UI –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- Options Pattern –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### Hexagonal Architecture
```
Presentation (gRPC/HTTP) ‚Üí Application (Services) ‚Üí Domain ‚Üí Infrastructure (Repositories)
```

### Dependency Injection
- Extension –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ DI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- Lifetime management (Singleton, Scoped, Transient)

### Configuration Management
- Multi-source –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (JSON, Environment, Custom Provider)
- Options Pattern —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ IOptionsMonitor

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤

–ö–∞–∂–¥–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç docker-compose —Ñ–∞–π–ª –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```bash
# Lab 2
cd src/lab-2
docker-compose up -d

# Lab 3
cd src/lab-3
docker-compose up -d

# Lab 4
cd src/lab-4
docker-compose up -d
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ concerns, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ DI
- **–ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º**: –≤ –ë–î —á–µ—Ä–µ–∑ JSON, –≤ gRPC —á–µ—Ä–µ–∑ oneof, –≤ HTTP —á–µ—Ä–µ–∑ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —á–µ—Ä–µ–∑ interceptors/middleware
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å**: ACID –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: event-driven –ø–æ–¥—Ö–æ–¥, –ø–∞–≥–∏–Ω–∞—Ü–∏—è

## –£—á–µ–±–Ω—ã–µ —Ü–µ–ª–∏

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ –≤:
- –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä
- –†–∞–±–æ—Ç–µ —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
- –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π .NET —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ best practices enterprise —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
